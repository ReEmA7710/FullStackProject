- name: Deploy to Kubernetes
  hosts: k8s_server
  tasks:

    - name: Apply MySQL Deployment
      command: kubectl apply -f /home/ubuntu/mysql-deployment.yaml

    - name: Render backend deployment from template
      template:
        src: backend-deployment.yaml.j2
        dest: /home/ubuntu/backend-deployment.yaml
        owner: ubuntu
        group: ubuntu
        mode: '0644'

    - name: Apply Backend Deployment
      command: kubectl apply -f /home/ubuntu/backend-deployment.yaml

    - name: Render frontend deployment from template
      template:
        src: frontend-deployment.yaml.j2
        dest: /home/ubuntu/frontend-deployment.yaml
        owner: ubuntu
        group: ubuntu
        mode: '0644'

    - name: Apply Frontend Deployment
      command: kubectl apply -f /home/ubuntu/frontend-deployment.yaml
